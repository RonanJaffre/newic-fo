---
import type { Article } from "@/types";
import Button from "../ui/Button.astro";
import { getAllPosts, getAllEvents } from "@/lib/wordpress";
import Badge from "../ui/Badge.astro";
import BadgeCorner from "../ui/BadgeCorner.astro";
import { Input } from "../ui/input";
import ArticleCard from "../ArticleCard.astro";

// src/components/home/News.astro

const articles = await getAllPosts(6);
const events = await getAllEvents(3);

const featuredArticle: Article = articles[0];
---

<section id="news-section" class="pt-2">
  <div class="">
    <!-- Onglets de navigation -->
    <div class="flex gap-3 mb-8 flex-wrap">
      <div class="hidden ld:flex md:flex flex-row gap-x-3">
        <Button> Toutes </Button>
        <Button variant="outlined"> Actualités </Button>
        <Button variant="outlined"> Dossiers </Button>
      </div>
      <div
        class="border-b-1 border-b-primary flex flex-row items-center flex-1"
      >
        <svg
          width="12"
          height="12"
          viewBox="0 0 12 12"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M2.44454 9.63912L4.75 7.33367M4.75 7.33367C5.24765 7.83132 5.93515 8.13912 6.69454 8.13912C8.21333 8.13912 9.44454 6.90791 9.44454 5.38912C9.44454 3.87034 8.21333 2.63912 6.69454 2.63912C5.17576 2.63912 3.94454 3.87034 3.94454 5.38912C3.94454 6.14852 4.25235 6.83602 4.75 7.33367Z"
            stroke="#1D1D1D"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>

        <Input placeholder="Recherche sur le site..." />
      </div>
      <Button variant="contained" color="secondary">
        <svg
          width="12"
          height="12"
          viewBox="0 0 12 12"
          stroke="currentColor"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="flex lg:hidden md:hidden"
        >
          <path
            d="M2.44454 9.63906L4.75 7.33361M4.75 7.33361C5.24765 7.83126 5.93515 8.13906 6.69454 8.13906C8.21333 8.13906 9.44454 6.90785 9.44454 5.38906C9.44454 3.87028 8.21333 2.63906 6.69454 2.63906C5.17576 2.63906 3.94454 3.87028 3.94454 5.38906C3.94454 6.14845 4.25235 6.83595 4.75 7.33361Z"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
        <span class="hidden lg:flex md:flex">Valider</span>
      </Button>
      <Button
        variant="contained"
        color="primary"
        class="flex lg:hidden md:hidden"
        ><svg
          width="12"
          height="12"
          viewBox="0 0 12 12"
          stroke="currentColor"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M9 4C9 4.82843 8.32843 5.5 7.5 5.5C6.67157 5.5 6 4.82843 6 4M9 4C9 3.17157 8.32843 2.5 7.5 2.5C6.67157 2.5 6 3.17157 6 4M9 4H10M6 4H2M3 8C3 8.82843 3.67157 9.5 4.5 9.5C5.32843 9.5 6 8.82843 6 8M3 8C3 7.17157 3.67157 6.5 4.5 6.5C5.32843 6.5 6 7.17157 6 8M3 8H2M6 8H10"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </Button>
    </div>

    <div
      class="w-full grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 lg:grid-cols-3 md:grid-cols-3 gap-6 mt-6 max-h-[378px]"
    >
      <div
        class="col-span-1 sm:col-span-1 xl:col-span-3 lg:col-span-2 md:col-span-2 relative max-h-[378px]"
      >
        <ArticleCard article={featuredArticle} large />
      </div>
      <div
        class="bg-primary text-secondary rounded-2xl px-4 py-6 shadow-lg w-fit flex flex-col justify-between"
      >
        <h2 class="text-2xl font-bold lg:mb-8 md:mb-1 mb-[2px] leading-none">
          Évènements à venir
        </h2>

        <div class="space-y-4 lg:mb-8 md:mb-1 mb-[2px]">
          {
            events.map((event) => (
              <div class="flex flex-row justify-center items-center lg:gap-x-3 lg:gap-y-3 lg:pb-3 md:gap-x-2 md:gap-y-2 md:pb-2 gap-x-[5px] gap-y-[5px] pb-[5px] border-b-1 border-[#DF877E]">
                <Badge
                  variant="outlined"
                  color="secondary"
                  class="border-white text-white h-fit"
                >
                  {event.date}
                </Badge>
                <div class="flex-1">
                  <h3 class="font-[900] text-[16px] leading-[16px]">
                    {event.title}
                  </h3>
                </div>
              </div>
            ))
          }
        </div>

        <a
          href="/events"
          class="w-full flex flex-row justify-end items-center gap-2 text-white hover:text-gray-200 transition-colors font-semibold text-sm group"
        >
          Voir plus
          <svg
            class="w-4 h-4 group-hover:translate-x-1 transition-transform"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      </div>
    </div>

    <div
      class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 lg:grid-cols-3 md:grid-cols-3 gap-6 mt-6"
    >
      {articles.map((article) => <ArticleCard article={article} />)}
    </div>

    <!-- Bouton Voir plus -->
    <div class="text-center mt-8">
      <a href="/blog">
        <Button variant="contained" color="secondary" class="bg-card-foreground"
          >Voir plus</Button
        >
      </a>
    </div>
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
