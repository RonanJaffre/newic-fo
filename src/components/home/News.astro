---
import type { Article } from "@/types";
import Button from "../ui/Button";
import { getAllPosts, getAllEvents } from "@/lib/wordpress";
import Badge from "../ui/Badge.astro";
import ArticleCard from "../ArticleCard.astro";
import Filter from "../client-ui/Filter";
import ArticlesAstro from "./ArticlesAstro.astro";

// src/components/home/News.astro

const pathname = Astro.url.pathname;
const articles = await getAllPosts(1);
const events = await getAllEvents(3);

const featuredArticle: Article = articles[0];
---

<section id="news-section" class="pt-2">
  <div class="">
    <!-- Onglets de navigation -->
    <Filter client:only />
    <div
      class="w-full grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 lg:grid-cols-3 md:grid-cols-3 gap-6 mt-6 max-h-[378px]"
    >
      <div
        class="col-span-1 sm:col-span-1 xl:col-span-3 lg:col-span-2 md:col-span-2 relative max-h-[378px]"
      >
        <ArticleCard article={featuredArticle} large />
      </div>
      <div
        class="bg-primary text-secondary rounded-2xl px-4 py-6 shadow-lg w-fit flex flex-col justify-between cursor-pointer"
      >
        <h2 class="text-2xl font-bold lg:mb-8 md:mb-1 mb-[2px] leading-none">
          Évènements à venir
        </h2>

        <div class="space-y-4 lg:mb-8 md:mb-1 mb-[2px]">
          {
            events.map((event) => (
              <a href={event.link}>
                <div class="flex flex-row justify-center items-center lg:gap-x-3 lg:gap-y-3 lg:pb-3 md:gap-x-2 md:gap-y-2 md:pb-2 gap-x-[5px] gap-y-[5px] pb-[5px] border-b-1 border-[#DF877E]">
                  <Badge
                    variant="outlined"
                    color="secondary"
                    class="border-white text-white h-fit"
                  >
                    {event.date}
                  </Badge>
                  <div class="flex-1">
                    <h3 class="font-[900] text-[16px] leading-[16px]">
                      {event.title}
                    </h3>
                  </div>
                </div>
              </a>
            ))
          }
        </div>

        {
          pathname !== "blog" && (
            <a
              href="/events"
              class="w-full flex flex-row justify-end items-center gap-2 text-white hover:text-gray-200 transition-colors font-semibold text-sm group"
            >
              Voir plus
              <svg
                class="w-4 h-4 group-hover:translate-x-1 transition-transform"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"
                />
              </svg>
            </a>
          )
        }
      </div>
    </div>

    <ArticlesAstro articles={articles} />

    <!-- Bouton Voir plus -->
    <div class="text-center mt-8">
      <a href="/">
        <Button
          variant="contained"
          color="secondary"
          className="bg-card-foreground">Voir plus</Button
        >
      </a>
    </div>
  </div>
</section>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
