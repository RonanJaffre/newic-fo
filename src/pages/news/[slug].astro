---
import ArticleDetail from "@/components/article/ArticleDetail.astro";
import Container from "@/components/layout/Container.astro";
import Layout from "@/components/layout/Layout.astro";
import Badge from "@/components/ui/Badge.astro";
import Button from "@/components/ui/Button.astro";
import { getAllNews } from "@/lib/wordpress";
import { getNewsBySlug } from "@/lib/wordpress";

// Astro component skeleton

export async function getStaticPaths() {
  const posts = await getAllNews(); // Récupère tous les articles
  return posts.map((post) => ({
    params: { slug: post.slug }, // Définit les slugs pour les routes dynamiques
  }));
}

const { slug } = Astro.params; // Récupère le slug depuis l'URL
const post = await getNewsBySlug(slug ?? "");

if (!post) {
  throw new Error(`Article non trouvé pour le slug : ${slug}`);
}

const {
  date,
  excerpt,
  title,
  cover,
  badge,
} = post;
---

<Layout title={title} description={excerpt}>
  <Container class="bg-primary-foreground">
    <div class="content">
      <div class="w-full">
        <!-- HEADER TITLE -->
        <div class="w-full pt-1 pb-1">
          <h1 class="text-[64px] font-[800] font-bold text-secondary leading-none">
            {title}
          </h1>
          <div class="w-full flex flex-row justify-between">
            <p class="text-[12px] font-[700] text-[#CFC5B4] mt-1">Actualités</p>
            <p class="text-[12px] font-[700] text-[#CFC5B4] mt-1">{date}</p>
          </div>
        </div>

        <!-- MAIN IMAGE -->
        <div class="relative">
          {
            badge && (
              <Badge
                variant="outlined"
                class="bg-white border-white absolute top-3 right-3"
              >
                {badge}
              </Badge>
            )
          }
          <img
            src={cover}
            alt="cover"
            class="w-full h-[480px] object-cover rounded-xl"
          />
        </div>
      </div>
    </div>
  </Container>
  <Container>
    <div class="content container">
      <div class="mx-auto flex items-center justify-between mt-4">
        <ArticleDetail article={post} />
      </div>
    </div>
  </Container>
  <style>
    .content {
      max-width: 1002px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</Layout>
